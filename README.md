# ArtChaosBot - Telegram-бот для бронирования времени в творческой мастерской

## Описание

Telegram-бот для бронирования времени в творческой мастерской. Позволяет пользователям выбирать дату и время для бронирования через удобный диалоговый интерфейс.

## Технологический стек

- **Python 3.8+**
- **python-telegram-bot v20+** - асинхронная библиотека для работы с Telegram Bot API
- **SQLAlchemy 2.0+** - ORM для работы с базой данных
- **SQLite** - легковесная база данных
- **aiosqlite** - асинхронный драйвер для SQLite

## Установка и запуск

### 1. Установка зависимостей

```bash
pip install -r requirements.txt
```

### 2. Настройка бота

1. Создайте бота через [@BotFather](https://t.me/BotFather) в Telegram
2. Получите токен бота
3. Замените `YOUR_BOT_TOKEN_HERE` в файле `bot.py` на ваш токен:

```python
BOT_TOKEN = "1234567890:ABCdefGHIjklMNOpqrsTUVwxyz"  # Ваш токен
```

### 3. Запуск бота

```bash
python bot.py
```

## Структура проекта

```
/artchaos_bot
├── bot.py           # Основной файл с логикой бота
├── database.py      # Функции для работы с базой данных
├── requirements.txt # Список зависимостей
├── README.md        # Документация
└── bookings.db      # База данных SQLite (создается автоматически)
```

## Функциональность

### Команды бота

- `/start` - Начать работу с ботом
- `/book` - Забронировать время в мастерской
- `/help` - Показать справку
- `/cancel` - Отменить текущее бронирование

### Процесс бронирования

1. **Выбор даты**: Пользователь выбирает дату из ближайших 7 дней
2. **Выбор времени**: Пользователь выбирает время начала бронирования
3. **Подтверждение**: Бот сохраняет бронирование и отправляет подтверждение

### База данных

Таблица `bookings` содержит:
- `id` - уникальный идентификатор (автоинкремент)
- `user_id` - ID пользователя в Telegram
- `username` - имя пользователя (необязательно)
- `start_time` - время начала бронирования
- `end_time` - время окончания бронирования

## Настройка

### Временные слоты

В файле `bot.py` можно настроить доступные временные слоты:

```python
TIME_SLOTS = [
    "10:00", "11:00", "12:00", "13:00", "14:00", "15:00", 
    "16:00", "17:00", "18:00", "19:00", "20:00", "21:00"
]
```

### Длительность бронирования

```python
BOOKING_DURATION = 2  # в часах
```

## Тестирование

✅ **Все компоненты протестированы и работают корректно!**

Протестированная функциональность:
- ✅ Инициализация базы данных SQLite
- ✅ Создание и сохранение бронирований
- ✅ Проверка конфликтов времени
- ✅ Получение бронирований пользователя
- ✅ Работа с несколькими пользователями
- ✅ Создание инлайн-клавиатур для выбора даты и времени
- ✅ Парсинг данных из callback_data
- ✅ Расчет длительности бронирования

База данных `bookings.db` создается автоматически при первом запуске.

## ConversationHandler - как это работает

`ConversationHandler` - это мощный инструмент для создания многошаговых диалогов в Telegram-ботах:

1. **Состояния**: Каждый шаг диалога имеет свое состояние (SELECTING_DATE, SELECTING_TIME)
2. **Entry points**: Точки входа в диалог (команда /book)
3. **Handlers**: Обработчики для каждого состояния
4. **Fallbacks**: Обработчики для отмены или ошибок

В нашем случае:
- Команда `/book` запускает диалог и переводит в состояние SELECTING_DATE
- Выбор даты переводит в состояние SELECTING_TIME
- Выбор времени завершает диалог и сохраняет бронирование

## Дальнейшее развитие

Возможные улучшения:
- Проверка наложения бронирований (уже реализована)
- Выбор длительности бронирования
- Просмотр существующих бронирований
- Отмена бронирований
- Уведомления о приближающихся бронированиях
- Административные функции
- Интеграция с календарем

## Безопасность

⚠️ **Важно**: В продакшене обязательно:
- Используйте переменные окружения для токена бота
- Добавьте валидацию входных данных
- Реализуйте систему прав доступа
- Добавьте логирование и мониторинг
